<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158845844-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158845844-1');</script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery-cookiebar/1.0.5/jquery.cookiebar.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/jquery-cookiebar/1.0.5/jquery.cookiebar.css><script type=text/javascript>$(document).ready(function(){$.cookieBar({fixed:true,acceptOnScroll:600,policyURL:'/privacy-policy/',policyButton:true,policyText:'Privacy Policy',expireDays:45});});</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Debugging of cypress psoc6 in Linux terminal.","headline":"Debugging of cypress psoc6 in Linux terminal.","description":"an example of how to use OpenOCD with dual-core cypress psoc6.","inLanguage":"en-US","author":"Yair Gadelov","creator":"Yair Gadelov","accountablePerson":"Yair Gadelov","copyrightHolder":"Yair Gadelov","copyrightYear":"2020","url":"https:\/\/yairgd.github.io\/2020\/11\/debugging-of-cypress-psoc6-in-linux-terminal.\/","wordCount":"478","image":[],"keywords":["cypress.","openocd"]}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js></script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Debugging of cypress psoc6 in Linux terminal.</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="an example of how to use OpenOCD with dual-core cypress psoc6."><link href="https://fonts.googleapis.com/css?family=Open+Sans" rel=stylesheet><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css><link rel=stylesheet href=https://yairgd.github.io/css/blog.css></head><body><nav class="navbar is-fixed-top" role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://yairgd.github.io/>Home</a>
<a class=navbar-item href=/pages/about>About</a>
<a class=navbar-item href=/blog>Blog</a>
<a class=navbar-item href=/pages/cv>CV</a>
<a class=navbar-item href=/projects>Projects</a>
<a class=navbar-item href=/pages/search>Search</a></div></nav><section class="hero is-info is-medium"><div class=hero-body style=background-image:url(https://yairgd.github.io/img/bg-blog1.jpg)><div class="container has-text-centered"><br><h1 class="title is-size-1">Debugging of cypress psoc6 in Linux terminal.</h1></div></div></section><div class=container><div class=section><div class=columns><div class="column is-9"><div class="tile is-child box"><div class=content><article class=media><div class=media-content><div class=content><p class="title is-5"><a href=https://yairgd.github.io/2020/11/debugging-of-cypress-psoc6-in-linux-terminal./>Debugging of cypress psoc6 in Linux terminal.</a></p><p class="subtitle is-size-6 has-text-grey-light">Published at November 5, 2020 &#183;
<i class="far fa-clock"></i>&nbsp;3 min read
&#183; Tags:
<a href=https://yairgd.github.io/tags/cypress./>cypress.</a>
<a href=https://yairgd.github.io/tags/openocd/>openocd</a></p></br></div></div></article><p>I have used OpenOCD in my embedded projects, and here is a simple explanation how to work with OpenOCD with <a href=https://www.cypress.com/documentation/development-kitsboards/psoc-6-ble-pioneer-kit-cy8ckit-062-ble>PSOC6</a> of cypress and here. Cypress has its own porting for <a href=https://github.com/Cypress-OpenOCD/OpenOCD>OpenOCD</a> for its <a href=https://www.cypress.com/documentation/development-kitsboards/kitprog-user-guide>interfaces</a>: kitprog3 & kitprog4. Usually, I work on a Linux terminal using a command line with cgdb but, OpenOCD is already installed on <a href=https://www.cypress.com/products/modustoolbox-software-environment>modus</a>, the default IDE of cypress.<br>The PSOC6 is dual-core MCU: CM0+ and CM4, and when booting, it first powers on the CM0+, and if the CM4 is also needed, the CM0+ has to power it on. Using OpenOCD, it can debug both processors at the same time. Each processor will have a separate port that will control it.</p><h2 id=openocd-setup>OpenOCD setup</h2><p>This is my favorite setup when working with an embedded project on a Linux terminal.</p><p>Run the OpenOCD server. The cypress programmer should be connected.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd  ~/path/to/cypress/openocd/scripts  
sudo ../bin/openocd -f interface/kitprog3.cfg -f target/psoc6.cfg -c <span style=color:#e6db74>&#34;program /home/yair/bis25/Debug/frontend/cm4_src/cm4&#34;</span>
</code></pre></div><p>I added the following addition to the original <em>psoc6.cfg</em> so port 60000 contrlos CM4 and port 70000 to controls CM0+ and also added thread awereness when using freeertos on CM4.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>psoc6.cpu.cm4 configure -gdb-port <span style=color:#ae81ff>60000</span>
psoc6.cpu.cm0 configure -gdb-port <span style=color:#ae81ff>70000</span>
psoc6.cpu.cm4 configure -rtos auto -rtos-wipe-on-reset-halt <span style=color:#ae81ff>1</span>
</code></pre></div><p>In another terminal, I open a telnet session to the OpenOCD server using the default 4444 port</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>telnet  127.0.0.1 <span style=color:#ae81ff>4444</span>
</code></pre></div><p>In the telnet session, I have used this command to program the device (Usually after compilation)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>program /path/to/cm4/prog.elf;reset
</code></pre></div><p>and this is the output message :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kitprog3: acquiring PSoC device...
target halted due to debug-request, current mode: Thread 
xPSR: 0x01000000 pc: 0x00001f34 msp: 0x080477a8
** Device acquired successfully
** psoc6.cpu.cm4: Ran after reset and before halt...
target halted due to debug-request, current mode: Thread 
xPSR: 0x61000000 pc: 0x1600400c msp: <span style=color:#ae81ff>00000000</span>
** Programming Started **
auto erase enabled
Flash write discontinued at 0x10009530, next section at 0x10080000
Padding image section <span style=color:#ae81ff>0</span> at 0x10009530 with <span style=color:#ae81ff>208</span> bytes <span style=color:#f92672>(</span>bank write end alignment<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span> <span style=color:#f92672>[</span><span style=color:#75715e>################################] [ Erasing     ]</span>
<span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span> <span style=color:#f92672>[</span><span style=color:#75715e>################################] [ Programming ]</span>
Padding image section <span style=color:#ae81ff>2</span> at 0x10093d5c with <span style=color:#ae81ff>164</span> bytes <span style=color:#f92672>(</span>bank write end alignment<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span> <span style=color:#f92672>[</span><span style=color:#75715e>################################] [ Erasing     ]</span>
<span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span> <span style=color:#f92672>[</span><span style=color:#75715e>################################] [ Programming ]</span>
wrote <span style=color:#ae81ff>119808</span> bytes from file /path/to/cm4/prog.elf  in 3.906287s <span style=color:#f92672>(</span>29.952 KiB/s<span style=color:#f92672>)</span>
</code></pre></div><h2 id=gdb-setup>gdb setup</h2><p>It has to place the following content in the file <em>~/.gdbinit</em>. This creates a custom <em>reset</em> command that restarts the debugging session. You can name it &ldquo;r&rdquo; to make consume time during debugging.</p><pre><code class=language-gdb data-lang=gdb>define reset
  mon reset    				# reset the whole chip
  mon psoc6 reset_halt sysresetreq      # resets and halts only cm4 (or cm0+)
  flushregs 	                        # taken from modus
  mon gdb_sync                          # taken from modus
  stepi
  c         
end
</code></pre><p>before any call to <em>restart</em> it has to connect to the OpenOCD server using:</p><pre><code class=language-gdb data-lang=gdb>target remote 127.0.0.1 PORT
</code></pre><p>Where <em>PORT</em> is either 60000 to debug CM4 or nighter 70000 to debug CM0+, needless to say that, the target elf file should be for the correct processor.</p><h2 id=references>References</h2><p><a href=https://www.mouser.com/pdfdocs/AN221774_Getting_Started_with_PSoC_6_MCU.pdf>[1] https://www.mouser.com/pdfdocs/AN221774_Getting_Started_with_PSoC_6_MCU.pdf</a></p></div><div class=content><div class=disqus-comments>Comments<div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"yairgd-github-io-1"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><div class="column is-3"><div class=card><div class=card-content><h2 class="title is-5">Categories</h2><div class=tags><span class=tag><a href=https://yairgd.github.io/categories/algorithm>algorithm</a></span>
<span class=tag><a href=https://yairgd.github.io/categories/development>development</a></span>
<span class=tag><a href=https://yairgd.github.io/categories/embedded>embedded</a></span>
<span class=tag><a href=https://yairgd.github.io/categories/golang>golang</a></span>
<span class=tag><a href=https://yairgd.github.io/categories/linux>linux</a></span>
<span class=tag><a href=https://yairgd.github.io/categories/python>python</a></span>
<span class=tag><a href=https://yairgd.github.io/categories/qt5>qt5</a></span></div></div></div><br><div class=card><div class=card-content><h2 class="title is-5">Tags</h2><div class=tags><span class=tag><a href=https://yairgd.github.io/tags/bayer>bayer</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/computer-vision>computer-vision</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/cypress.>cypress.</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/development>development</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/eclipse>eclipse</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/embedded>embedded</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/go>go</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/golang>golang</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/hugo>hugo</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/kalman-filter>kalman-filter</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/kernel>kernel</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/linux>linux</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/openocd>openocd</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/opkg>opkg</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/qt5>qt5</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/rgb>rgb</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/rt>rt</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/statstical-abitrage>statstical-abitrage</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/stm32>stm32</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/templates>templates</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/themes>themes</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/usb>usb</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/yocto>yocto</a></span>
<span class=tag><a href=https://yairgd.github.io/tags/zynq>zynq</a></span></div></div></div><br><div class=card><div class=card-content><h2 class="title is-5">Recent posts</h2><h2><a href=https://yairgd.github.io/2021/01/linux-gadget-device./>Linux Gadget Device.</a></h2><time class="has-text-grey-light is-size-7">19 January 2021</time><h2><a href=https://yairgd.github.io/2020/11/install-embedded-linux-toolchain-on-windows/>Install embedded Linux toolchain on windows</a></h2><time class="has-text-grey-light is-size-7">25 November 2020</time><h2><a href=https://yairgd.github.io/2020/11/debugging-of-cypress-psoc6-in-linux-terminal./>Debugging of cypress psoc6 in Linux terminal.</a></h2><time class="has-text-grey-light is-size-7">5 November 2020</time><h2><a href=https://yairgd.github.io/2020/10/simple-openamp-application-for-stm32mp157/>Simple OpenAMP application for stm32mp157</a></h2><time class="has-text-grey-light is-size-7">25 October 2020</time><h2><a href=https://yairgd.github.io/2020/10/compile-linux-kernel-for-zynq/>Compile Linux kernel for zynq</a></h2><time class="has-text-grey-light is-size-7">17 October 2020</time></div></div><br><br><div class=card><div class=card-content><h2 class="title is-5">Archives</h2><a href=https://yairgd.github.io/archives/2021>2021</a> (1)<br><a href=https://yairgd.github.io/archives/2020>2020</a> (18)<br><a href=https://yairgd.github.io/archives/2014>2014</a> (4)<br></div></div></div></div></div></div><footer class="footer has-background-grey-darker has-text-white"><div class="content has-text-centered"><p><span class="icon is-large"><a href="https://m.facebook.com/yair.gadelov?ref=bookmarks" class=mysocial rel=me><i class="fab fa-facebook fa-3x"></i></a></span>&nbsp;&nbsp;
<span class="icon is-large"><a href=https://www.linkedin.com/mwlite/in/yair-gadelov-1972ab17/ class=mysocial rel=me><i class="fab fa-linkedin fa-3x"></i></a></span>&nbsp;&nbsp;
<span class="icon is-large"><a href=https://github.com/yairgd/ class=mysocial rel=me><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;<br><br>Copyright &copy; Yair Gadelov Tech Blog 2021 - Theme by <a href=https://jeffprod.com class=mysocial>JeffProd.com</a>
- <a class=mysocial href=https://yairgd.github.io/about>About</a><br></p></div></footer><script defer src=https://use.fontawesome.com/releases/v5.1.0/js/all.js></script></body></html>